id: io.github.e_j_w.SpecFitter
runtime: org.freedesktop.Platform
runtime-version: '25.08'
sdk: org.freedesktop.Sdk
command: io.github.e_j_w.SpecFitter
finish-args:
  # X11 + XShm access
  - --share=ipc
  - --socket=fallback-x11
  # Wayland access
  - --socket=wayland
  # GPU acceleration
  - --device=dri
  # allow opening files directly from the file manager or command line
  # (there might be a better way to do this with portals that I'm unaware of)
  - --filesystem=host:ro
modules:
  - name: specfitter
    buildsystem: simple
    build-commands:
      - make -j ${FLATPAK_BUILDER_N_JOBS}
      # rename executable for compatibility with KDE task manager
      # which assumes the same name for the executable and .desktop file
      - mv specfitter io.github.e_j_w.SpecFitter
      - sed -i 's#/usr/bin/specfitter#io.github.e_j_w.SpecFitter#g' data/io.github.e_j_w.SpecFitter.desktop
      # install
      - install -Dm755 io.github.e_j_w.SpecFitter -t ${FLATPAK_DEST}/bin
      - install -Dm644 data/io.github.e_j_w.SpecFitter.metainfo.xml -t ${FLATPAK_DEST}/share/metainfo
      - install -Dm644 data/io.github.e_j_w.SpecFitter.svg -t ${FLATPAK_DEST}/share/icons/hicolor/scalable/apps
      - install -Dm644 data/io.github.e_j_w.SpecFitter.desktop -t ${FLATPAK_DEST}/share/applications
      - install -Dm644 data/io.github.e_j_w.SpecFitter-mime.xml -t ${FLATPAK_DEST}/share/mime/packages
    sources:
      - type: git
        url: https://github.com/e-j-w/SpecFitter.git
    cleanup:
      - 'specfitter-resources.c'
